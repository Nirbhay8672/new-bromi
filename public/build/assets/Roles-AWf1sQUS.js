import{d as j,r as p,o as q,n as z,c as o,a as n,b as C,u as M,h as O,w as T,e,f as m,g as i,F as k,i as R,j as E,t as c,k as N,p as w}from"./app-C8I2FI9v.js";import{_ as G,a as W}from"./StrikingDashLayout.vue_vue_type_style_index_0_lang-B5xXflrV.js";import{_ as Z}from"./Input.vue_vue_type_script_setup_true_lang-BhDB-aqQ.js";import"./index-B3beVsow.js";import"./index-CMWG4mbA.js";import"./utils-TfETDaq2.js";import"./index-x9fwfB49.js";const H={class:"container-fluid"},J={class:"card border-0 shadow-sm"},K={class:"card-body p-0"},Q={key:0,class:"text-center py-5"},X={key:1,class:"table-responsive"},Y={class:"table table-hover mb-0"},I={class:"border-0"},ee={class:"d-flex align-items-center"},se={class:"mb-0 fw-semibold"},te={class:"border-0"},ae={class:"d-flex flex-wrap gap-1"},le={key:0,class:"badge bg-secondary"},oe={key:1,class:"text-muted small"},ne={class:"border-0"},re={class:"d-flex align-items-center"},ie={class:"badge bg-primary"},de={class:"border-0"},ce={class:"d-flex align-items-center"},me={class:"text-dark"},ue={class:"border-0"},pe={class:"d-flex gap-2"},be=["onClick"],ve=["onClick","disabled","title"],he={key:0},ge={class:"modal-dialog modal-lg modal-dialog-centered",role:"document"},fe={class:"modal-content"},_e={class:"modal-header"},ye={class:"modal-title"},xe={class:"modal-body"},ke={key:0,class:"alert alert-danger",role:"alert"},we={class:"mb-3"},Ce={key:0,class:"invalid-feedback d-block"},Re={class:"mb-3"},Ne={class:"form-label"},De={class:"badge bg-primary ms-2"},Me={class:"row"},Ee={class:"form-check"},$e=["id","checked","onChange"],Ae=["for"],Pe={key:0,class:"text-muted"},Se={class:"modal-footer"},Ue=["disabled"],Ve={key:0,class:"spinner-border spinner-border-sm me-2",role:"status"},Be={key:1,"data-feather":"save",class:"me-2"},Fe={class:"modal-dialog modal-dialog-centered",role:"document"},Le={class:"modal-content"},je={class:"modal-body"},qe={class:"alert alert-warning"},ze={class:"d-flex align-items-start"},Oe={class:"mb-0 mt-2"},Te={key:2,class:"modal-backdrop fade show"},Ge=j({__name:"Roles",props:{roles:{},permissions:{}},setup($){const h=$,g=p(!1),_=p(!1),u=p(null),f=p(null),l=p({name:"",permissions:[]}),r=p({}),b=p(!1);q(()=>{z(()=>{typeof feather<"u"&&feather.replace()})});const A=()=>{u.value=null,l.value={name:"",permissions:[]},r.value={},g.value=!0},P=a=>{u.value=a,l.value={name:a.name,permissions:a.permissions.map(s=>s.id)},r.value={},g.value=!0,console.log("Opening edit modal for role:",{role:a,formData:l.value,permissions:a.permissions})},S=a=>{f.value=a,_.value=!0},y=()=>{g.value=!1,u.value=null,l.value={name:"",permissions:[]},r.value={},document.body.classList.remove("modal-open")},x=()=>{_.value=!1,f.value=null},D=async()=>{if(r.value={},!l.value.name||l.value.name.trim()===""){r.value.name="Role name is required.";return}if(l.value.name.length<2){r.value.name="Role name must be at least 2 characters long.";return}if(l.value.name.length>255){r.value.name="Role name must not exceed 255 characters.";return}if(!/^[a-zA-Z0-9\s\-_]+$/.test(l.value.name)){r.value.name="Role name can only contain letters, numbers, spaces, hyphens, and underscores.";return}b.value=!0;try{const s=u.value?`/admin/roles/${u.value.id}`:"/admin/roles",t=u.value?"put":"post";console.log("Submitting role:",{url:s,method:t,data:l.value}),await w[t](s,l.value,{onSuccess:d=>{console.log("Role saved successfully:",d),y(),w.reload()},onError:d=>{console.error("Validation errors:",d),r.value=d},onFinish:()=>{console.log("Request finished")}})}catch(s){console.error("Error submitting form:",s),r.value.general="An error occurred while saving the role. Please try again."}finally{b.value=!1}},U=async()=>{if(f.value)try{await w.delete(`/admin/roles/${f.value.id}`,{onSuccess:()=>{x(),w.reload()}})}catch(a){console.error("Error deleting role:",a)}},V=a=>{const s=l.value.permissions.indexOf(a);s>-1?l.value.permissions.splice(s,1):l.value.permissions.push(a),console.log("Permission toggled:",a,"Current permissions:",l.value.permissions)},B=a=>{switch(a.toLowerCase()){case"super-admin":return"bg-danger";case"admin":return"bg-warning text-dark";case"user":return"bg-primary";default:return"bg-secondary"}},F=a=>new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),v=a=>a.filter(s=>{const t=s.name.split(" ");return t.length===1||!["create","read","update","delete","manage"].includes(t[0])});return(a,s)=>(n(),o(k,null,[C(M(O),{title:"Roles Management"}),C(G,null,{default:T(()=>[e("div",H,[e("div",{class:"row"},[e("div",{class:"col-lg-12"},[e("div",{class:"breadcrumb-main d-flex align-items-center justify-content-between"},[s[2]||(s[2]=e("h4",{class:"text-capitalize breadcrumb-title mb-0"},"Roles Management",-1)),e("button",{onClick:A,class:"btn btn-primary"},s[1]||(s[1]=[e("span",{"data-feather":"plus",class:"me-2"},null,-1),i(" Add Role ",-1)]))])])]),e("div",J,[s[11]||(s[11]=e("div",{class:"card-header bg-white border-bottom"},[e("h5",{class:"mb-0 d-flex align-items-center"},[e("span",{"data-feather":"shield",class:"me-2 text-primary"}),i(" Roles & Permissions ")])],-1)),e("div",K,[h.roles.length===0?(n(),o("div",Q,s[3]||(s[3]=[e("span",{"data-feather":"shield",class:"text-muted mb-3",style:{width:"48px",height:"48px"}},null,-1),e("h6",{class:"text-muted"},"No roles found",-1),e("p",{class:"text-muted mb-0"},'Click "Add Role" to create your first role.',-1)]))):(n(),o("div",X,[e("table",Y,[s[10]||(s[10]=e("thead",{class:"table-light"},[e("tr",null,[e("th",{class:"border-0 fw-semibold"},"Role"),e("th",{class:"border-0 fw-semibold"},"Permissions"),e("th",{class:"border-0 fw-semibold"},"Users"),e("th",{class:"border-0 fw-semibold"},"Created"),e("th",{class:"border-0 fw-semibold"},"Actions")])],-1)),e("tbody",null,[(n(!0),o(k,null,R(h.roles,t=>(n(),o("tr",{key:t.id,class:"align-middle"},[e("td",I,[e("div",ee,[s[4]||(s[4]=e("div",{class:"me-3"},[e("div",{class:"avatar-title bg-primary bg-gradient rounded-circle d-flex align-items-center justify-content-center",style:{width:"40px",height:"40px"}},[e("span",{"data-feather":"shield",class:"text-white",style:{width:"20px",height:"20px"}})])],-1)),e("div",null,[e("h6",se,[e("span",{class:E(["badge me-1",B(t.name)])},c(t.name.replace("-"," ").toUpperCase()),3)])])])]),e("td",te,[e("div",ae,[(n(!0),o(k,null,R(v(t.permissions).slice(0,3),d=>(n(),o("span",{key:d.id,class:"badge bg-light text-dark border"},c(d.name.replace("-"," ").replace(/\b\w/g,L=>L.toUpperCase())),1))),128)),v(t.permissions).length>3?(n(),o("span",le," +"+c(v(t.permissions).length-3)+" more ",1)):m("",!0),v(t.permissions).length===0?(n(),o("span",oe," No general permissions ")):m("",!0)])]),e("td",ne,[e("div",re,[s[5]||(s[5]=e("span",{"data-feather":"users",class:"me-2 text-muted"},null,-1)),e("span",ie,c(t.users_count||0)+" users ",1)])]),e("td",de,[e("div",ce,[s[6]||(s[6]=e("span",{"data-feather":"calendar",class:"me-2 text-muted"},null,-1)),e("span",me,c(F(t.created_at)),1)])]),e("td",ue,[e("div",pe,[e("button",{onClick:d=>P(t),class:"btn btn-outline-primary btn-sm",title:"Edit Role"},s[7]||(s[7]=[e("span",{"data-feather":"edit",class:"me-1"},null,-1),i(" Edit ",-1)]),8,be),e("button",{onClick:d=>S(t),class:"btn btn-outline-danger btn-sm",disabled:t.name==="super-admin",title:t.name==="super-admin"?"Cannot delete super admin role":"Delete Role"},s[8]||(s[8]=[e("span",{"data-feather":"trash-2",class:"me-1"},null,-1),i(" Delete ",-1)]),8,ve)])])]))),128)),h.roles.length===0?(n(),o("tr",he,s[9]||(s[9]=[e("td",{colspan:"5",class:"text-center py-5"},[e("div",{class:"d-flex flex-column align-items-center"},[e("span",{"data-feather":"shield",class:"text-muted mb-3",style:{width:"48px",height:"48px"}}),e("h6",{class:"text-muted"},"No roles found"),e("p",{class:"text-muted mb-0"},'Click "Add Role" to create your first role.')])],-1)]))):m("",!0)])])]))])])]),g.value?(n(),o("div",{key:0,class:"modal fade show d-block",tabindex:"-1",role:"dialog",onClick:N(y,["self"])},[e("div",ge,[e("div",fe,[e("div",_e,[e("h5",ye,c(u.value?"Edit Role":"Add New Role"),1),e("button",{type:"button",class:"btn-close",onClick:y})]),e("div",xe,[r.value.general?(n(),o("div",ke,[s[12]||(s[12]=e("span",{"data-feather":"alert-circle",class:"me-2"},null,-1)),i(" "+c(r.value.general),1)])):m("",!0),e("form",{onSubmit:N(D,["prevent"])},[e("div",we,[s[14]||(s[14]=e("label",{for:"roleName",class:"form-label"},[i(" Role Name "),e("span",{class:"text-danger"},"*")],-1)),C(M(Z),{id:"roleName",modelValue:l.value.name,"onUpdate:modelValue":s[0]||(s[0]=t=>l.value.name=t),type:"text",class:E(["form-control",{"is-invalid":r.value.name}]),placeholder:"Enter role name (e.g., manager, editor, viewer)",required:"",maxlength:"255"},null,8,["modelValue","class"]),r.value.name?(n(),o("div",Ce,[s[13]||(s[13]=e("span",{"data-feather":"alert-circle",class:"me-1"},null,-1)),i(" "+c(r.value.name),1)])):m("",!0),s[15]||(s[15]=e("div",{class:"form-text"},[e("span",{"data-feather":"info",class:"me-1"}),i(' Use descriptive names like "manager", "editor", or "viewer". Only letters, numbers, spaces, hyphens, and underscores are allowed. ')],-1))]),e("div",Re,[e("label",Ne,[s[16]||(s[16]=i(" Permissions ",-1)),e("span",De,c(l.value.permissions.length)+" selected",1)]),e("div",Me,[(n(!0),o(k,null,R(v(h.permissions),t=>(n(),o("div",{key:t.id,class:"col-md-6 col-lg-4 mb-2"},[e("div",Ee,[e("input",{id:`permission-${t.id}`,checked:l.value.permissions.includes(t.id),onChange:d=>V(t.id),type:"checkbox",class:"form-check-input"},null,40,$e),e("label",{for:`permission-${t.id}`,class:"form-check-label"},c(t.name.replace("-"," ").replace(/\b\w/g,d=>d.toUpperCase())),9,Ae)])]))),128))]),v(h.permissions).length===0?(n(),o("div",Pe," No general permissions available. ")):m("",!0)])],32)]),e("div",Se,[e("button",{type:"button",class:"btn btn-secondary",onClick:y}," Cancel "),e("button",{type:"button",class:"btn btn-primary",onClick:D,disabled:b.value||!l.value.name.trim()},[b.value?(n(),o("span",Ve)):m("",!0),b.value?m("",!0):(n(),o("span",Be)),i(" "+c(b.value?"Saving...":u.value?"Update Role":"Create Role"),1)],8,Ue)])])])])):m("",!0),_.value?(n(),o("div",{key:1,class:"modal fade show d-block",tabindex:"-1",role:"dialog",onClick:N(x,["self"])},[e("div",Fe,[e("div",Le,[e("div",{class:"modal-header"},[s[17]||(s[17]=e("h5",{class:"modal-title text-danger"},[e("span",{"data-feather":"alert-triangle",class:"me-2"}),i(" Delete Role ")],-1)),e("button",{type:"button",class:"btn-close",onClick:x})]),e("div",je,[e("div",qe,[e("div",ze,[s[22]||(s[22]=e("span",{"data-feather":"alert-triangle",class:"me-2 mt-1"},null,-1)),e("div",null,[s[20]||(s[20]=e("strong",null,"Warning:",-1)),s[21]||(s[21]=i(" This action cannot be undone. ",-1)),e("p",Oe,[s[18]||(s[18]=i(" Are you sure you want to delete the role ",-1)),e("strong",null,'"'+c(f.value?.name)+'"',1),s[19]||(s[19]=i("? All users with this role will lose their permissions. ",-1))])])])])]),e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary",onClick:x}," Cancel "),e("button",{type:"button",class:"btn btn-danger",onClick:U},s[23]||(s[23]=[e("span",{"data-feather":"trash-2",class:"me-2"},null,-1),i(" Delete Role ",-1)]))])])])])):m("",!0),g.value||_.value?(n(),o("div",Te)):m("",!0)]),_:1})],64))}}),Ye=W(Ge,[["__scopeId","data-v-f88635c2"]]);export{Ye as default};
