import{d as L,r as b,c as o,o as n,a as C,u as E,h as q,w as O,b as e,e as m,f as r,F as k,g as R,n as M,t as c,i as N,l as w}from"./app-CGiAyPmw.js";import{_ as j,a as T}from"./StrikingDashLayout.vue_vue_type_style_index_0_lang-BAbHqe9-.js";import{_ as G}from"./Input.vue_vue_type_script_setup_true_lang-DcqTz-Z6.js";import"./index-DQMGoRvG.js";import"./index-CMWG4mbA.js";import"./assets-BhRWUkGH.js";import"./utils-TfETDaq2.js";import"./index-S5UXgDOi.js";const W={class:"container-fluid"},Z={class:"card border-0 shadow-sm"},H={class:"card-body p-0"},J={key:0,class:"text-center py-5"},K={key:1,class:"table-responsive"},Q={class:"table table-hover mb-0"},X={class:"border-0"},Y={class:"d-flex align-items-center"},I={class:"mb-0 fw-semibold"},ee={class:"border-0"},se={class:"d-flex flex-wrap gap-1"},te={key:0,class:"badge bg-secondary"},le={key:1,class:"text-muted small"},ae={class:"border-0"},oe={class:"d-flex align-items-center"},ne={class:"badge bg-primary"},ie={class:"border-0"},re={class:"d-flex align-items-center"},de={class:"text-dark"},ce={class:"border-0"},me={class:"d-flex gap-2"},ue=["onClick"],be=["onClick","disabled","title"],ve={key:0},pe={class:"modal-dialog modal-lg modal-dialog-centered",role:"document"},fe={class:"modal-content"},ge={class:"modal-header"},he={class:"modal-title"},_e={class:"modal-body"},ye={key:0,class:"alert alert-danger",role:"alert"},xe={class:"mb-3"},ke={key:0,class:"invalid-feedback d-block"},we={class:"mb-3"},Ce={class:"form-label"},Re={class:"badge bg-primary ms-2"},Ne={class:"row"},De={class:"form-check"},Ee=["id","checked","onChange"],Me=["for"],$e={key:0,class:"text-muted"},Ae={class:"modal-footer"},Pe=["disabled"],Se={key:0,class:"spinner-border spinner-border-sm me-2",role:"status"},Ue={key:1,class:"fas fa-save me-2"},Ve={class:"modal-dialog modal-dialog-centered",role:"document"},ze={class:"modal-content"},Be={class:"modal-body"},Fe={class:"alert alert-warning"},Le={class:"d-flex align-items-start"},qe={class:"mb-0 mt-2"},Oe={key:2,class:"modal-backdrop fade show"},je=L({__name:"Roles",props:{roles:{},permissions:{}},setup($){const f=$,g=b(!1),_=b(!1),u=b(null),h=b(null),a=b({name:"",permissions:[]}),i=b({}),v=b(!1),A=()=>{u.value=null,a.value={name:"",permissions:[]},i.value={},g.value=!0},P=l=>{u.value=l,a.value={name:l.name,permissions:l.permissions.map(s=>s.id)},i.value={},g.value=!0,console.log("Opening edit modal for role:",{role:l,formData:a.value,permissions:l.permissions})},S=l=>{h.value=l,_.value=!0},y=()=>{g.value=!1,u.value=null,a.value={name:"",permissions:[]},i.value={},document.body.classList.remove("modal-open")},x=()=>{_.value=!1,h.value=null},D=async()=>{if(i.value={},!a.value.name||a.value.name.trim()===""){i.value.name="Role name is required.";return}if(a.value.name.length<2){i.value.name="Role name must be at least 2 characters long.";return}if(a.value.name.length>255){i.value.name="Role name must not exceed 255 characters.";return}if(!/^[a-zA-Z0-9\s\-_]+$/.test(a.value.name)){i.value.name="Role name can only contain letters, numbers, spaces, hyphens, and underscores.";return}v.value=!0;try{const s=u.value?`/admin/roles/${u.value.id}`:"/admin/roles",t=u.value?"put":"post";console.log("Submitting role:",{url:s,method:t,data:a.value}),await w[t](s,a.value,{onSuccess:d=>{console.log("Role saved successfully:",d),y(),w.reload()},onError:d=>{console.error("Validation errors:",d),i.value=d},onFinish:()=>{console.log("Request finished")}})}catch(s){console.error("Error submitting form:",s),i.value.general="An error occurred while saving the role. Please try again."}finally{v.value=!1}},U=async()=>{if(h.value)try{await w.delete(`/admin/roles/${h.value.id}`,{onSuccess:()=>{x(),w.reload()}})}catch(l){console.error("Error deleting role:",l)}},V=l=>{const s=a.value.permissions.indexOf(l);s>-1?a.value.permissions.splice(s,1):a.value.permissions.push(l),console.log("Permission toggled:",l,"Current permissions:",a.value.permissions)},z=l=>{switch(l.toLowerCase()){case"super-admin":return"bg-danger";case"admin":return"bg-warning text-dark";case"user":return"bg-primary";default:return"bg-secondary"}},B=l=>new Date(l).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),p=l=>l.filter(s=>{const t=s.name.split(" ");return t.length===1||!["create","read","update","delete","manage"].includes(t[0])});return(l,s)=>(n(),o(k,null,[C(E(q),{title:"Roles Management"}),C(j,null,{default:O(()=>[e("div",W,[e("div",{class:"row"},[e("div",{class:"col-lg-12"},[e("div",{class:"breadcrumb-main d-flex align-items-center justify-content-between"},[s[2]||(s[2]=e("h4",{class:"text-capitalize breadcrumb-title mb-0"},"Roles Management",-1)),e("button",{onClick:A,class:"btn btn-primary"},s[1]||(s[1]=[e("i",{class:"fas fa-plus me-2"},null,-1),r(" Add Role ",-1)]))])])]),e("div",Z,[s[11]||(s[11]=e("div",{class:"card-header bg-white border-bottom"},[e("h5",{class:"mb-0 d-flex align-items-center"},[e("i",{class:"fas fa-shield-alt me-2 text-primary"}),r(" Roles & Permissions ")])],-1)),e("div",H,[f.roles.length===0?(n(),o("div",J,s[3]||(s[3]=[e("i",{class:"fas fa-shield-alt text-muted mb-3",style:{"font-size":"48px"}},null,-1),e("h6",{class:"text-muted"},"No roles found",-1),e("p",{class:"text-muted mb-0"},'Click "Add Role" to create your first role.',-1)]))):(n(),o("div",K,[e("table",Q,[s[10]||(s[10]=e("thead",{class:"table-light"},[e("tr",null,[e("th",{class:"border-0 fw-semibold"},"Role"),e("th",{class:"border-0 fw-semibold"},"Permissions"),e("th",{class:"border-0 fw-semibold"},"Users"),e("th",{class:"border-0 fw-semibold"},"Created"),e("th",{class:"border-0 fw-semibold"},"Actions")])],-1)),e("tbody",null,[(n(!0),o(k,null,R(f.roles,t=>(n(),o("tr",{key:t.id,class:"align-middle"},[e("td",X,[e("div",Y,[s[4]||(s[4]=e("div",{class:"me-3"},[e("div",{class:"avatar-title bg-primary bg-gradient rounded-circle d-flex align-items-center justify-content-center",style:{width:"40px",height:"40px"}},[e("i",{class:"fas fa-shield-alt text-white",style:{"font-size":"20px"}})])],-1)),e("div",null,[e("h6",I,[e("span",{class:M(["badge me-1",z(t.name)])},c(t.name.replace("-"," ").toUpperCase()),3)])])])]),e("td",ee,[e("div",se,[(n(!0),o(k,null,R(p(t.permissions).slice(0,3),d=>(n(),o("span",{key:d.id,class:"badge bg-light text-dark border"},c(d.name.replace("-"," ").replace(/\b\w/g,F=>F.toUpperCase())),1))),128)),p(t.permissions).length>3?(n(),o("span",te," +"+c(p(t.permissions).length-3)+" more ",1)):m("",!0),p(t.permissions).length===0?(n(),o("span",le," No general permissions ")):m("",!0)])]),e("td",ae,[e("div",oe,[s[5]||(s[5]=e("i",{class:"fas fa-users me-2 text-muted"},null,-1)),e("span",ne,c(t.users_count||0)+" users ",1)])]),e("td",ie,[e("div",re,[s[6]||(s[6]=e("i",{class:"fas fa-calendar me-2 text-muted"},null,-1)),e("span",de,c(B(t.created_at)),1)])]),e("td",ce,[e("div",me,[e("button",{onClick:d=>P(t),class:"btn btn-outline-primary btn-sm",title:"Edit Role"},s[7]||(s[7]=[e("i",{class:"fas fa-edit me-1"},null,-1),r(" Edit ",-1)]),8,ue),e("button",{onClick:d=>S(t),class:"btn btn-outline-danger btn-sm",disabled:t.name==="super-admin",title:t.name==="super-admin"?"Cannot delete super admin role":"Delete Role"},s[8]||(s[8]=[e("i",{class:"fas fa-trash me-1"},null,-1),r(" Delete ",-1)]),8,be)])])]))),128)),f.roles.length===0?(n(),o("tr",ve,s[9]||(s[9]=[e("td",{colspan:"5",class:"text-center py-5"},[e("div",{class:"d-flex flex-column align-items-center"},[e("i",{class:"fas fa-shield-alt text-muted mb-3",style:{"font-size":"48px"}}),e("h6",{class:"text-muted"},"No roles found"),e("p",{class:"text-muted mb-0"},'Click "Add Role" to create your first role.')])],-1)]))):m("",!0)])])]))])])]),g.value?(n(),o("div",{key:0,class:"modal fade show d-block",tabindex:"-1",role:"dialog",onClick:N(y,["self"])},[e("div",pe,[e("div",fe,[e("div",ge,[e("h5",he,c(u.value?"Edit Role":"Add New Role"),1),e("button",{type:"button",class:"btn-close",onClick:y})]),e("div",_e,[i.value.general?(n(),o("div",ye,[s[12]||(s[12]=e("i",{class:"fas fa-exclamation-circle me-2"},null,-1)),r(" "+c(i.value.general),1)])):m("",!0),e("form",{onSubmit:N(D,["prevent"])},[e("div",xe,[s[14]||(s[14]=e("label",{for:"roleName",class:"form-label"},[r(" Role Name "),e("span",{class:"text-danger"},"*")],-1)),C(E(G),{id:"roleName",modelValue:a.value.name,"onUpdate:modelValue":s[0]||(s[0]=t=>a.value.name=t),type:"text",class:M(["form-control",{"is-invalid":i.value.name}]),placeholder:"Enter role name (e.g., manager, editor, viewer)",required:"",maxlength:"255"},null,8,["modelValue","class"]),i.value.name?(n(),o("div",ke,[s[13]||(s[13]=e("i",{class:"fas fa-exclamation-circle me-1"},null,-1)),r(" "+c(i.value.name),1)])):m("",!0),s[15]||(s[15]=e("div",{class:"form-text"},[e("i",{class:"fas fa-info-circle me-1"}),r(' Use descriptive names like "manager", "editor", or "viewer". Only letters, numbers, spaces, hyphens, and underscores are allowed. ')],-1))]),e("div",we,[e("label",Ce,[s[16]||(s[16]=r(" Permissions ",-1)),e("span",Re,c(a.value.permissions.length)+" selected",1)]),e("div",Ne,[(n(!0),o(k,null,R(p(f.permissions),t=>(n(),o("div",{key:t.id,class:"col-md-6 col-lg-4 mb-2"},[e("div",De,[e("input",{id:`permission-${t.id}`,checked:a.value.permissions.includes(t.id),onChange:d=>V(t.id),type:"checkbox",class:"form-check-input"},null,40,Ee),e("label",{for:`permission-${t.id}`,class:"form-check-label"},c(t.name.replace("-"," ").replace(/\b\w/g,d=>d.toUpperCase())),9,Me)])]))),128))]),p(f.permissions).length===0?(n(),o("div",$e," No general permissions available. ")):m("",!0)])],32)]),e("div",Ae,[e("button",{type:"button",class:"btn btn-secondary",onClick:y}," Cancel "),e("button",{type:"button",class:"btn btn-primary",onClick:D,disabled:v.value||!a.value.name.trim()},[v.value?(n(),o("span",Se)):m("",!0),v.value?m("",!0):(n(),o("i",Ue)),r(" "+c(v.value?"Saving...":u.value?"Update Role":"Create Role"),1)],8,Pe)])])])])):m("",!0),_.value?(n(),o("div",{key:1,class:"modal fade show d-block",tabindex:"-1",role:"dialog",onClick:N(x,["self"])},[e("div",Ve,[e("div",ze,[e("div",{class:"modal-header"},[s[17]||(s[17]=e("h5",{class:"modal-title text-danger"},[e("i",{class:"fas fa-exclamation-triangle me-2"}),r(" Delete Role ")],-1)),e("button",{type:"button",class:"btn-close",onClick:x})]),e("div",Be,[e("div",Fe,[e("div",Le,[s[22]||(s[22]=e("i",{class:"fas fa-exclamation-triangle me-2 mt-1"},null,-1)),e("div",null,[s[20]||(s[20]=e("strong",null,"Warning:",-1)),s[21]||(s[21]=r(" This action cannot be undone. ",-1)),e("p",qe,[s[18]||(s[18]=r(" Are you sure you want to delete the role ",-1)),e("strong",null,'"'+c(h.value?.name)+'"',1),s[19]||(s[19]=r("? All users with this role will lose their permissions. ",-1))])])])])]),e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary",onClick:x}," Cancel "),e("button",{type:"button",class:"btn btn-danger",onClick:U},s[23]||(s[23]=[e("i",{class:"fas fa-trash me-2"},null,-1),r(" Delete Role ",-1)]))])])])])):m("",!0),g.value||_.value?(n(),o("div",Oe)):m("",!0)]),_:1})],64))}}),Xe=T(je,[["__scopeId","data-v-95424e03"]]);export{Xe as default};
